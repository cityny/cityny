name: Repo List Generator
on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  repo-list:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Get Repo List
        id: repo_data
        uses: yi-Xu-0100/repo-list-generator@v1.1.1
        with:
          user: cityny
          my_token: ${{ secrets.REPO_TOKEN }}
          max_page: 1
          allow_empty: true
          block_list: "" # Para que no ignore tu repo actual

      - name: Update README.md
        run: |
          # 1. Capturamos el output que viste en la documentaci√≥n
          # Usamos un delimitador especial (EOF) para evitar problemas con saltos de l√≠nea
          echo "LISTA_REPOS<<EOF" >> $GITHUB_ENV
          echo "${{ steps.repo_data.outputs.repoList }}" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Write to File
        run: |
          # 2. Usamos sed para inyectar la lista entre tus etiquetas
          # Esto es puro manejo de archivos como en un VPS
          sed -i "//,//c\\n${{ env.LISTA_REPOS }}\n" README.md

      - name: Commit and Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "ü§ñ Actualizaci√≥n autom√°tica de proyectos" || echo "Nada que actualizar"
          git push
